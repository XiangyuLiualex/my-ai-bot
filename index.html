<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 助手</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
        }
        .chat-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>欢迎来到 AI 助手网站</h1>
    <p>点击右下角按钮与 AI 助手对话！</p>

    <div class="chat-container">
        <!-- Coze AI Chat SDK -->
        <script src="https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.2.0-beta.5/libs/oversea/index.js"></script>
        <script>
            // 生成唯一 ID
            function generateUniqueId(prefix) {
                return prefix + '-' + Math.random().toString(36).substr(2, 9);
            }

            // 获取或创建会话 ID，存入 sessionStorage
            function getOrCreateConversationId() {
                let storedId = sessionStorage.getItem('conversation_id');
                if (!storedId) {
                    storedId = generateUniqueId('session'); // 生成唯一会话 ID
                    sessionStorage.setItem('conversation_id', storedId);
                }
                return storedId;
            }

            // 获取或创建用户 ID，存入 localStorage
            function getOrCreateUserId() {
                let storedUserId = localStorage.getItem('user_id');
                if (!storedUserId) {
                    storedUserId = generateUniqueId('user'); // 生成唯一用户 ID
                    localStorage.setItem('user_id', storedUserId);
                }
                return storedUserId;
            }

            // 初始化 Coze AI 助手
            const chatClient = new CozeWebSDK.WebChatClient({
                config: {
                    bot_id: '7481792028402565175',
                    conversation_id: getOrCreateConversationId(), // 每个会话独立
                    user_id: getOrCreateUserId(), // 识别不同用户
                },
                componentProps: {
                    title: 'Coze AI 助手',
                },
                auth: {
                    type: 'token',
                    token: 'pat_9zLSZMNPS7QTpdKACsRIgTr9jjT1oj1OvcYZ9Vabb1CBZlXSOvzZPzUpGN8vZtPY',
                    onRefreshToken: function () {
                        return 'pat_9zLSZMNPS7QTpdKACsRIgTr9jjT1oj1OvcYZ9Vabb1CBZlXSOvzZPzUpGN8vZtPY';
                    }
                }
            });

            // 确保每个设备对话是独立的
            chatClient.resetConversation();
        </script>
    </div>
</body>
</html>
